<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>æ±½è½¦ä¸Šä¸‹å¡é—®é¢˜ - äº¤äº’å¼åŠ¨ç”»</title>
    <link href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <link rel="stylesheet" href="navigation.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: #333;
            line-height: 1.6;
            font-size: 24px;
            margin: 0;
            padding: 0;
        }

        section {
            width: 100%;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 2rem;
            opacity: 0.9;
            text-align: center;
        }

        .content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }

        .card h2 {
            color: #2196F3;
            margin-bottom: 30px;
            font-size: 2.5rem;
            border-bottom: 3px solid #2196F3;
            padding-bottom: 15px;
        }

        .problem-text {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 6px solid #2196F3;
            font-size: 1.2em;
        }

        .problem-text h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .problem-text p {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .simulation-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .animation-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .animation-title {
            text-align: center;
            color: #2196F3;
            margin-bottom: 30px;
            font-weight: bold;
            font-size: 1.8rem;
        }

        .hill-scene {
            position: relative;
            width: 100%;
            height: 300px;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px solid #3498db;
        }

        .sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 70%;
            background: linear-gradient(to bottom, #1e90ff, #87ceeb);
        }

        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30%;
            background: linear-gradient(to top, #8bc34a, #7cb342);
        }

        .hill-svg-container {
            position: absolute;
            bottom: 30%;
            width: 100%;
            height: 200px;
        }

        .hill-svg {
            width: 100%;
            height: 100%;
        }

        .car {
            position: absolute;
            width: 80px;
            height: 40px;
            background: #e74c3c;
            border-radius: 10px 10px 0 0;
            transition: all 0.05s linear;
            z-index: 10;
            transform-origin: center center;
            /* ç§»é™¤ä¹‹å‰çš„ bottom å®šä½ï¼Œæ”¹ç”¨ top å’Œ left */
            top: 0;
            left: 0;
        }

        .car-body {
            position: absolute;
            width: 100%;
            height: 70%;
            background: #e74c3c;
            border-radius: 10px 10px 0 0;
        }

        .car-top {
            position: absolute;
            top: 8px;
            left: 10px;
            width: 40px;
            height: 20px;
            background: #3498db;
            border-radius: 5px;
        }

        .wheel {
            position: absolute;
            bottom: -8px;
            width: 16px;
            height: 16px;
            background: #2c3e50;
            border-radius: 50%;
            border: 2px solid #7f8c8d;
        }

        .wheel.front {
            left: 15px;
        }

        .wheel.back {
            right: 15px;
        }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 25px;
        }

        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .info-card::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .info-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
        }

        .info-card > div:first-child {
            font-size: 1.1rem;
            font-weight: 600;
            opacity: 0.95;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 2.4rem;
            font-weight: 900;
            margin-top: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider {
            flex: 1;
            height: 12px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #e0e0e0 0%, #f5f5f5 100%);
            border-radius: 10px;
            outline: none;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .slider:hover {
            background: linear-gradient(to right, #d0d0d0 0%, #e5e5e5 100%);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.5);
            transition: all 0.3s;
            border: 3px solid #fff;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.7);
        }

        .slider::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        .slider-value {
            min-width: 70px;
            text-align: center;
            font-weight: 800;
            color: #667eea;
            font-size: 1.4rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            padding: 8px 15px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .time-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .time-rate-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .time-rate-buttons {
            display: flex;
            gap: 10px;
        }

        .time-rate-btn {
            padding: 8px 15px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-rate-btn:hover {
            background: #27ae60;
        }

        .time-rate-btn.active {
            background: #e74c3c;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            padding: 18px 35px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            flex: 1;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        button::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(-1px) scale(0.98);
        }

        button:disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            opacity: 0.6;
        }

        button:disabled:hover {
            transform: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .calculation-area {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .step {
            margin: 20px 0;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #3498db;
            font-size: 1.2em;
        }

        .step-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 50px;
            margin-right: 15px;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .equation {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            overflow-x: auto;
            font-size: 1.8rem;
            border: 3px dashed #2196F3;
        }

        .final-answer {
            background: #e8f5e9;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border-left: 5px solid #4caf50;
        }

        .final-answer h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .diagram-line {
            stroke: #e74c3c;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
        }

        .diagram-text {
            fill: #2c3e50;
            font-size: 18px;
            font-weight: bold;
        }

        .formula-text {
            fill: #fff;
            font-size: 16px;
            font-weight: 700;
            font-family: 'Microsoft YaHei', 'Times New Roman', serif;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.6));
        }

        .formula-background {
            fill: rgba(33, 150, 243, 0.95);
            stroke: #fff;
            stroke-width: 2;
            rx: 10;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }


        .path-marker {
            fill: #fff;
            font-size: 32px;
            font-weight: 800;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.8));
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .collapsible-section {
            margin-top: 20px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 18px 25px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 15px;
            margin-bottom: 15px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
        }

        .collapsible-header:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            border-color: rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
        }

        .collapsible-header h3 {
            margin: 0;
            color: #667eea;
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .collapsible-icon {
            font-size: 1.5rem;
            transition: transform 0.3s;
            color: #667eea;
            font-weight: bold;
        }
        
        .collapsible-header:hover .collapsible-icon {
            transform: scale(1.2);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.expanded {
            max-height: 1000px;
            transition: max-height 0.3s ease-in;
        }

        .preset-selector {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .preset-buttons {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .preset-btn {
            flex: 1;
            padding: 18px 35px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }

        .preset-btn::before {
            content: "ğŸš—";
            position: absolute;
            left: 20px;
            font-size: 1.5rem;
            transition: transform 0.3s;
        }

        .preset-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.6);
        }

        .preset-btn:hover::before {
            transform: translateX(5px);
        }

        .preset-btn.active {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.5);
        }

        .preset-btn.active::before {
            content: "âœ“";
        }


        @media (max-width: 768px) {
            .simulation-area {
                min-width: 100%;
            }

            .info-panel {
                grid-template-columns: repeat(2, 1fr);
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<section data-section="1" id="section1">
    <div class="container">
        <div class="header">
            <h1>ğŸš— æ±½è½¦ä¸Šä¸‹å¡é—®é¢˜</h1>
            <p>ç”¨åŠ¨ç”»ç†è§£äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹ç»„çš„å®é™…åº”ç”¨</p>
        </div>

        <div class="card">
            <h2>ğŸ“ é¢˜ç›®å±•ç¤º</h2>
            <div class="problem-text">
                <!--                    <h3>æ±½è½¦ä¸Šä¸‹å¡é—®é¢˜</h3>-->
                <p><strong>é¢˜ç›®ï¼š</strong>å°èªä¸€å®¶äººæš‘å‡å†³å®šå»è¥¿è—è‡ªé©¾æ¸¸ï¼Œçˆ¸çˆ¸è¡Œé©¶åˆ°å·è—å…¬è·¯æ—¶ï¼Œå‘ç°åœ°å½¢è¾ƒå¤æ‚ï¼Œæœ‰ä¸€æ®µä¸Šä¸‹å¡ã€‚ç”±äºä¸Šå¡éœ€è¦å…‹æœé‡åŠ›ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œè¿™æ—¶å°èªçœ‹åˆ°è¡¨ç›˜çš„é€Ÿåº¦æ˜¯ \(40\) km/hï¼Œè€Œç­‰åˆ°ä¸‹å¡æ—¶ï¼Œåœ¨é‡åŠ›çš„è¾…åŠ©ä¸‹ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œæ­¤æ—¶è¡¨ç›˜çš„é€Ÿåº¦å˜æˆäº† \(60\) km/hï¼Œæ•´ä¸ªè¿‡ç¨‹ç”¨äº† \(3\) å°æ—¶ã€‚æ—…è¡Œå‡ å¤©åå°èªä¸€å®¶äººå‡†å¤‡è¿”ç¨‹åˆç»è¿‡è¿™æ®µå…¬è·¯ï¼Œä¸Šä¸‹å¡çš„é€Ÿåº¦è·ŸåŸæ¥ä¸€æ ·ï¼Œè¿™æ—¶è¿”ç¨‹ç”¨äº† \(\frac{13}{4}\) å°æ—¶ã€‚çˆ¸çˆ¸é—®å°èªï¼šä½ å¯ä»¥ç®—ä¸€ä¸‹æˆ‘ä»¬å»çš„æ—¶å€™è¿™æ®µä¸Šå¡è·¯å’Œä¸‹å¡è·¯å„æ˜¯å¤šå°‘åƒç±³ï¼Ÿ
                </p>
<!--                <p style="margin-top: 15px; font-size: 0.95em; color: #666; font-style: italic;">ğŸ’¡-->
<!--                    åœ°ç†åº”ç”¨ï¼šæˆ‘å›½å±±åŒºå…¬è·¯ï¼ˆå¦‚å·è—å…¬è·¯ï¼‰è®¾è®¡æ—¶ï¼Œå·¥ç¨‹å¸ˆéœ€è¦è€ƒè™‘å¡åº¦å¯¹è½¦é€Ÿçš„å½±å“ï¼Œç¡®ä¿è¡Œè½¦å®‰å…¨ã€‚é“è·¯å¡åº¦é€šå¸¸ç”¨ç™¾åˆ†æ¯”è¡¨ç¤ºï¼Œå¦‚5%è¡¨ç¤ºæ¯100ç±³ä¸Šå‡5ç±³ã€‚</p>-->
            </div>
        </div>
    </div>
</section>

<section data-section="2" id="section2">
    <!--        <div class="container">-->
    <div class="card">
        <h2>ğŸ¬ ä¸Šä¸‹å¡åŠ¨ç”»æ¼”ç¤º</h2>
        <div class="animation-container">
            <!--                    <div class="animation-title">åˆ†æ­¥å±•ç¤ºæ±½è½¦é€šè¿‡ä¸Šä¸‹å¡çš„å®Œæ•´è¿‡ç¨‹</div>-->
            <div class="hill-scene">
                <div class="sky"></div>
                <div class="hill-svg-container">
                    <svg class="hill-svg" preserveAspectRatio="none" viewBox="0 0 1000 200">
                        <!-- å±±å¡è·¯å¾„ -->
                        <path d="M 100,200 L 500,50 L 900,200" fill="#795548" id="hillPath"/>
                        <!-- é“è·¯è·¯å¾„ -->
                        <path d="M 100,200 L 500,50 L 900,200" fill="#555" id="roadPath" stroke="none"/>
                        <!-- è·¯å¾„æ ‡è®° -->
                        <circle cx="100" cy="200" fill="#e74c3c" r="5"/>
                        <circle cx="500" cy="50" fill="#e74c3c" r="5"/>
                        <circle cx="900" cy="200" fill="#e74c3c" r="5"/>
                        <text class="path-marker" text-anchor="middle" x="100" y="190">èµ·ç‚¹</text>
                        <text class="path-marker" text-anchor="middle" x="500" y="40">æœ€é«˜ç‚¹</text>
                        <text class="path-marker" text-anchor="middle" x="900" y="190">ç»ˆç‚¹</text>

                        <!-- çº¿æ®µå›¾å›¾å±‚ -->
                        <g id="diagramOverlay">
                            <!-- è¿™é‡Œå°†é€šè¿‡JavaScriptæ·»åŠ çº¿æ®µ -->
                        </g>
                    </svg>
                </div>
                <div class="ground"></div>

                <!-- æ±½è½¦ -->
                <div class="car" id="car">
                    <div class="car-body"></div>
                    <div class="car-top"></div>
                    <div class="wheel front"></div>
                    <div class="wheel back"></div>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-card">
                    <div>å½“å‰ä½ç½®</div>
                    <div class="info-value" id="position">èµ·ç‚¹</div>
                </div>
                <div class="info-card">
                    <div>å½“å‰é€Ÿåº¦</div>
                    <div class="info-value" id="speed">0 km/h</div>
                </div>
                <div class="info-card">
                    <div>å·²ç”¨æ—¶é—´</div>
                    <div class="info-value" id="time">0 å°æ—¶</div>
                </div>
                <div class="info-card">
                    <div>è¡Œé©¶è·ç¦»</div>
                    <div class="info-value" id="distance">0 km</div>
                </div>
            </div>

            <!--                <div class="controls-panel">-->
            <!--                    <h2>æ§åˆ¶é¢æ¿</h2>-->
            <div class="preset-buttons">
                <button class="preset-btn active" data-preset="atob" id="presetAtoB">å»ç¨‹</button>
                <button class="preset-btn" data-preset="btoa" id="presetBtoA">è¿”ç¨‹</button>
            </div>
            <div class="buttons">
                <button id="startBtn">å¼€å§‹æ¨¡æ‹Ÿ</button>
                <button disabled id="pauseBtn">æš‚åœ</button>
                <button id="resetBtn">é‡ç½®</button>
                <button id="showFormulaBtn">æ˜¾ç¤ºæ•°å­¦å…³ç³»</button>
            </div>

            <div class="collapsible-section">

                <div class="collapsible-header" id="distanceHeader">
                    <h3>è‡ªå®šä¹‰å‚æ•°è®¾ç½®</h3>
                    <span class="collapsible-icon" id="distanceIcon">â–¼</span>
                </div>

                <div class="collapsible-content" id="distanceContent">
                    <div class="controls">
                        <div class="control-group">
                            <div class="control-title">ä¸Šå¡é€Ÿåº¦ (km/h)</div>
                            <div class="slider-container">
                                <input class="slider" id="uphillSpeed" max="100" min="10" type="range" value="40">
                                <span class="slider-value" id="uphillSpeedValue">40</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-title">ä¸‹å¡é€Ÿåº¦ (km/h)</div>
                            <div class="slider-container">
                                <input class="slider" id="downhillSpeed" max="100" min="10" type="range" value="60">
                                <span class="slider-value" id="downhillSpeedValue">60</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-title">ä¸Šå¡è·ç¦» (km)</div>
                            <div class="slider-container">
                                <input class="slider" id="uphillDistance" max="100" min="10" type="range" value="60">
                                <span class="slider-value" id="uphillDistanceValue">60</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-title">ä¸‹å¡è·ç¦» (km)</div>
                            <div class="slider-container">
                                <input class="slider" id="downhillDistance" max="100" min="10" type="range" value="90">
                                <span class="slider-value" id="downhillDistanceValue">90</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <div class="control-title">æ—¶é—´å€ç‡</div>
                            <div class="slider-container">
                                <input class="slider" id="timeRate" max="2000" min="1" type="range" value="2000">
                                <span class="slider-value" id="timeRateValue">2000x</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section data-section="3" id="section3">
    <div class="container">
        <div class="card">
            <h2>ğŸ“ å»ºç«‹äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹ç»„</h2>
            <div class="step">
                <span class="step-number">1</span>
                <strong>è®¾æœªçŸ¥æ•°</strong>
                <p>è®¾å»ç¨‹æ—¶çš„ä¸Šå¡è·¯ä¸º \( x \) åƒç±³ï¼Œä¸‹å¡è·¯ä¸º \( y \) åƒç±³ã€‚</p>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>å»ºç«‹æ–¹ç¨‹</strong>
                <p>å»ç¨‹ï¼šä¸Šå¡æ—¶é—´ \( \frac{x}{40} \) å°æ—¶ï¼Œä¸‹å¡æ—¶é—´ \( \frac{y}{60} \) å°æ—¶</p>
                <div class="equation">
                    \[ \frac{x}{40} + \frac{y}{60} = 3 \]
                </div>

                <p>è¿”ç¨‹ï¼šä¸Šå¡æ—¶é—´ \( \frac{y}{40} \) å°æ—¶ï¼ˆåŸæ¥çš„ä¸‹å¡å˜æˆä¸Šå¡ï¼‰ï¼Œä¸‹å¡æ—¶é—´ \( \frac{x}{60} \) å°æ—¶ï¼ˆåŸæ¥çš„ä¸Šå¡å˜æˆä¸‹å¡ï¼‰</p>
                <div class="equation">
                    \[ \frac{y}{40} + \frac{x}{60} = \frac{13}{4} \]
                </div>
            </div>
        </div>
    </div>
</section>

<section data-section="4" id="section4">
    <div class="container">
        <div class="card">
            <h2>ğŸ§® æ±‚è§£äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹ç»„</h2>
            <div class="step">
                <span class="step-number">3</span>
                <strong>è§£æ–¹ç¨‹ç»„</strong>
                <p>åŒ–ç®€æ–¹ç¨‹ç»„ï¼š</p>
                <div class="equation">
                    \[
                    \begin{cases}
                    3x + 2y = 360 \\
                    2x + 3y = 390
                    \end{cases}
                    \]
                </div>

                <p>è§£å¾—ï¼š</p>
                <div class="equation">
                    \[
                    \begin{cases}
                    x = 60 \\
                    y = 90
                    \end{cases}
                    \]
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // è·å–DOMå…ƒç´ 
        const car = document.getElementById('car');
        const hillPath = document.getElementById('hillPath');
        const diagramOverlay = document.getElementById('diagramOverlay');
        const positionElement = document.getElementById('position');
        const speedElement = document.getElementById('speed');
        const timeElement = document.getElementById('time');
        const distanceElement = document.getElementById('distance');

        const uphillSpeedSlider = document.getElementById('uphillSpeed');
        const downhillSpeedSlider = document.getElementById('downhillSpeed');
        const uphillDistanceSlider = document.getElementById('uphillDistance');
        const downhillDistanceSlider = document.getElementById('downhillDistance');
        const timeRateSlider = document.getElementById('timeRate');

        const uphillSpeedValue = document.getElementById('uphillSpeedValue');
        const downhillSpeedValue = document.getElementById('downhillSpeedValue');
        const uphillDistanceValue = document.getElementById('uphillDistanceValue');
        const downhillDistanceValue = document.getElementById('downhillDistanceValue');
        const timeRateValue = document.getElementById('timeRateValue');

        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const showFormulaBtn = document.getElementById('showFormulaBtn');

        // å¯æŠ˜å åŒºåŸŸç›¸å…³å…ƒç´ 
        const distanceHeader = document.getElementById('distanceHeader');
        const distanceContent = document.getElementById('distanceContent');
        const distanceIcon = document.getElementById('distanceIcon');
        const presetAtoB = document.getElementById('presetAtoB');
        const presetBtoA = document.getElementById('presetBtoA');

        // çŠ¶æ€å˜é‡
        let animationId = null;
        let isAnimating = false;
        let isPaused = false;
        let lastTimestamp = 0;
        let currentPosition = 0; // 0-1 è¡¨ç¤ºä½ç½®æ¯”ä¾‹
        let currentDistance = 0; // å·²è¡Œé©¶è·ç¦»(km)
        let currentTime = 0; // å·²ç”¨æ—¶é—´(å°æ—¶)
        let timeRate = 2000; // æ—¶é—´å€ç‡ï¼Œé»˜è®¤2000å€
        let showFormula = false; // æ˜¯å¦æ˜¾ç¤ºæ•°å­¦å…³ç³»

        // å±±å¡è·¯å¾„å‚æ•°
        const pathStartX = 100;
        const pathPeakX = 500;
        const pathEndX = 900;
        const pathStartY = 200;
        const pathPeakY = 50;
        const pathEndY = 200;

        // æ›´æ–°æ»‘å—æ˜¾ç¤ºå€¼
        function updateSliderValues() {
            uphillSpeedValue.textContent = uphillSpeedSlider.value;
            downhillSpeedValue.textContent = downhillSpeedSlider.value;
            uphillDistanceValue.textContent = uphillDistanceSlider.value;
            downhillDistanceValue.textContent = downhillDistanceSlider.value;
            timeRateValue.textContent = `${timeRateSlider.value}x`;
            timeRate = parseInt(timeRateSlider.value);
        }

        // åˆå§‹åŒ–æ»‘å—å€¼
        updateSliderValues();

        // è®¾ç½®æ—¶é—´å€ç‡é»˜è®¤å€¼ä¸º2000
        timeRateSlider.value = 2000;
        timeRate = 2000;
        timeRateValue.textContent = '2000x';

        // å¯æŠ˜å åŒºåŸŸå±•å¼€/æ”¶èµ·
        let isDistanceExpanded = false;
        distanceHeader.addEventListener('click', function () {
            isDistanceExpanded = !isDistanceExpanded;
            if (isDistanceExpanded) {
                distanceContent.classList.add('expanded');
                distanceIcon.textContent = 'â–²';
            } else {
                distanceContent.classList.remove('expanded');
                distanceIcon.textContent = 'â–¼';
            }
        });

        // é¢„è®¾æŒ‰é’®äº‹ä»¶
        presetAtoB.addEventListener('click', function () {
            presetAtoB.classList.add('active');
            presetBtoA.classList.remove('active');
            // å»ç¨‹ï¼šä¸Šå¡è·ç¦»x=60ï¼Œä¸‹å¡è·ç¦»y=90
            uphillDistanceSlider.value = 60;
            downhillDistanceSlider.value = 90;
            updateSliderValues();
            // é‡ç½®åŠ¨ç”»ä½ç½®å’ŒçŠ¶æ€
            currentPosition = 0;
            currentDistance = 0;
            currentTime = 0;
            isAnimating = false;
            isPaused = false;
            lastTimestamp = 0;
            cancelAnimationFrame(animationId);
            updateCarPosition();
            updateInfoPanel(currentPosition, 0, 0);
            if (showFormula) updateDiagram();
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.textContent = "æš‚åœ";
        });

        presetBtoA.addEventListener('click', function () {
            presetBtoA.classList.add('active');
            presetAtoB.classList.remove('active');
            // è¿”ç¨‹ï¼šä¸Šå¡è·ç¦»y=90ï¼ˆåŸæ¥çš„ä¸‹å¡ï¼‰ï¼Œä¸‹å¡è·ç¦»x=60ï¼ˆåŸæ¥çš„ä¸Šå¡ï¼‰
            uphillDistanceSlider.value = 90;
            downhillDistanceSlider.value = 60;
            updateSliderValues();
            // é‡ç½®åŠ¨ç”»ä½ç½®å’ŒçŠ¶æ€ï¼ˆä»å³å¾€å·¦ï¼Œæ‰€ä»¥ä½ç½®ä»1å¼€å§‹ï¼‰
            currentPosition = 1;
            currentDistance = 0;
            currentTime = 0;
            isAnimating = false;
            isPaused = false;
            lastTimestamp = 0;
            cancelAnimationFrame(animationId);
            updateCarPosition();
            updateInfoPanel(currentPosition, 0, 0);
            if (showFormula) updateDiagram();
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.textContent = "æš‚åœ";
        });

        // æ»‘å—äº‹ä»¶ç›‘å¬
        uphillSpeedSlider.addEventListener('input', function () {
            updateSliderValues();
            if (showFormula) updateDiagram();
        });
        downhillSpeedSlider.addEventListener('input', function () {
            updateSliderValues();
            if (showFormula) updateDiagram();
        });
        uphillDistanceSlider.addEventListener('input', function () {
            updateSliderValues();
            if (showFormula) updateDiagram();
        });
        downhillDistanceSlider.addEventListener('input', function () {
            updateSliderValues();
            if (showFormula) updateDiagram();
        });
        timeRateSlider.addEventListener('input', function () {
            updateSliderValues();
        });

        // æ˜¾ç¤ºæ•°å­¦å…³ç³»æŒ‰é’®
        showFormulaBtn.addEventListener('click', function () {
            showFormula = !showFormula;
            this.textContent = showFormula ? "éšè—æ•°å­¦å…³ç³»" : "æ˜¾ç¤ºæ•°å­¦å…³ç³»";
            updateDiagram();
        });

        // è·å–å½“å‰é€Ÿåº¦(åŸºäºä½ç½®)
        function getCurrentSpeed(position) {
            const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
            const uphillRatio = parseFloat(uphillDistanceSlider.value) / totalDistance;

            // è·å–å½“å‰é¢„è®¾æ–¹å‘
            const currentPreset = document.querySelector('.preset-btn.active')?.getAttribute('data-preset') || 'atob';
            const isBtoA = currentPreset === 'btoa';

            let actualPosition = position;
            if (isBtoA) {
                // ä»å³å¾€å·¦ï¼šåè½¬ä½ç½®
                actualPosition = 1 - position;
            }

            if (actualPosition <= uphillRatio) {
                // ä¸Šå¡æ®µ
                return parseFloat(uphillSpeedSlider.value);
            } else {
                // ä¸‹å¡æ®µ
                return parseFloat(downhillSpeedSlider.value);
            }
        }


        // æ ¹æ®ä½ç½®è®¡ç®—å·²è¡Œé©¶è·ç¦»
        function calculateDistanceFromPosition(position) {
            const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
            const uphillRatio = parseFloat(uphillDistanceSlider.value) / totalDistance;

            // è·å–å½“å‰é¢„è®¾æ–¹å‘
            const currentPreset = document.querySelector('.preset-btn.active')?.getAttribute('data-preset') || 'atob';
            const isBtoA = currentPreset === 'btoa';

            let actualPosition = position;
            if (isBtoA) {
                // ä»å³å¾€å·¦ï¼šåè½¬ä½ç½®
                actualPosition = 1 - position;
            }

            // æ ¹æ®ä½ç½®è®¡ç®—å·²è¡Œé©¶è·ç¦»
            const traveledDistance = actualPosition * totalDistance;
            return traveledDistance;
        }

        // æ ¹æ®è·ç¦»è®¡ç®—æ—¶é—´
        function calculateTimeFromDistance(position) {
            const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
            const uphillDistance = parseFloat(uphillDistanceSlider.value);
            const downhillDistance = parseFloat(downhillDistanceSlider.value);
            const uphillSpeed = parseFloat(uphillSpeedSlider.value);
            const downhillSpeed = parseFloat(downhillSpeedSlider.value);
            const uphillRatio = uphillDistance / totalDistance;

            // è·å–å½“å‰é¢„è®¾æ–¹å‘
            const currentPreset = document.querySelector('.preset-btn.active')?.getAttribute('data-preset') || 'atob';
            const isBtoA = currentPreset === 'btoa';

            let actualPosition = position;
            if (isBtoA) {
                // ä»å³å¾€å·¦ï¼šåè½¬ä½ç½®
                actualPosition = 1 - position;
            }

            let uphillDistTraveled = 0;
            let downhillDistTraveled = 0;

            if (actualPosition <= uphillRatio) {
                // è¿˜åœ¨ä¸Šå¡æ®µ
                uphillDistTraveled = actualPosition * totalDistance;
                downhillDistTraveled = 0;
            } else {
                // å·²ç»è¿›å…¥ä¸‹å¡æ®µ
                uphillDistTraveled = uphillDistance;
                downhillDistTraveled = (actualPosition - uphillRatio) * totalDistance;
            }

            // è®¡ç®—æ—¶é—´ï¼šæ—¶é—´ = è·ç¦» / é€Ÿåº¦
            const uphillTime = uphillDistTraveled / uphillSpeed;
            const downhillTime = downhillDistTraveled / downhillSpeed;
            const totalTime = uphillTime + downhillTime;

            return totalTime;
        }

        // æ›´æ–°ä¿¡æ¯é¢æ¿
        function updateInfoPanel(position, distance, time) {
            const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
            const uphillRatio = parseFloat(uphillDistanceSlider.value) / totalDistance;

            // è·å–å½“å‰é¢„è®¾æ–¹å‘
            const currentPreset = document.querySelector('.preset-btn.active')?.getAttribute('data-preset') || 'atob';
            const isBtoA = currentPreset === 'btoa';

            let actualPosition = position;
            if (isBtoA) {
                // ä»å³å¾€å·¦ï¼šåè½¬ä½ç½®
                actualPosition = 1 - position;
            }

            // æ›´æ–°ä½ç½®
            if (position < 0.01 || position > 0.99) {
                if (isBtoA) {
                    positionElement.textContent = position < 0.01 ? "ç»ˆç‚¹" : "èµ·ç‚¹";
                } else {
                    positionElement.textContent = position < 0.01 ? "èµ·ç‚¹" : "ç»ˆç‚¹";
                }
            } else if (actualPosition <= uphillRatio) {
                positionElement.textContent = "ä¸Šå¡ä¸­";
            } else {
                positionElement.textContent = "ä¸‹å¡ä¸­";
            }

            // æ›´æ–°é€Ÿåº¦
            speedElement.textContent = `${getCurrentSpeed(position)} km/h`;

            // æ ¹æ®å®é™…ä½ç½®è®¡ç®—è·ç¦»å’Œæ—¶é—´ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç´¯åŠ çš„å€¼
            const calculatedDistance = calculateDistanceFromPosition(position);
            const calculatedTime = calculateTimeFromDistance(position);

            // æ›´æ–°æ—¶é—´å’Œè·ç¦»
            timeElement.textContent = `${calculatedTime.toFixed(2)} å°æ—¶`;
            distanceElement.textContent = `${calculatedDistance.toFixed(1)} km`;
        }

        // æ›´æ–°æ•°å­¦å…³ç³»æ˜¾ç¤º
        function updateDiagram() {
            // æ¸…é™¤ç°æœ‰å†…å®¹
            diagramOverlay.innerHTML = '';

            if (!showFormula) return;

            const svgNS = "http://www.w3.org/2000/svg";
            const uphillDist = parseFloat(uphillDistanceSlider.value);
            const downhillDist = parseFloat(downhillDistanceSlider.value);
            const uphillSpeed = parseFloat(uphillSpeedSlider.value);
            const downhillSpeed = parseFloat(downhillSpeedSlider.value);

            // è®¡ç®—ä¸Šå¡å’Œä¸‹å¡çš„æ—¶é—´
            const uphillTime = uphillDist / uphillSpeed;
            const downhillTime = downhillDist / downhillSpeed;
            const totalTime = uphillTime + downhillTime;

            // æ ¹æ®å½“å‰é¢„è®¾ç¡®å®šæ–¹å‘
            const currentPreset = document.querySelector('.preset-btn.active')?.getAttribute('data-preset') || 'atob';
            const isBtoA = currentPreset === 'btoa';

            // ä¸Šå¡æ®µå…¬å¼æ˜¾ç¤º
            let uphillMidX, uphillMidY;
            if (isBtoA) {
                // ä¹™åˆ°ç”²ï¼šä¸Šå¡åœ¨å³ä¾§ï¼ˆä»å³å¾€å·¦ï¼‰
                uphillMidX = (pathPeakX + pathEndX) / 2;
                uphillMidY = (pathPeakY + pathEndY) / 2;
            } else {
                // ç”²åˆ°ä¹™ï¼šä¸Šå¡åœ¨å·¦ä¾§ï¼ˆä»å·¦å¾€å³ï¼‰
                uphillMidX = (pathStartX + pathPeakX) / 2;
                uphillMidY = (pathStartY + pathPeakY) / 2;
            }

            // ä¸Šå¡å…¬å¼èƒŒæ™¯
            const uphillBg = document.createElementNS(svgNS, "rect");
            uphillBg.setAttribute("class", "formula-background");
            uphillBg.setAttribute("x", uphillMidX - 140);
            uphillBg.setAttribute("y", uphillMidY - 35);
            uphillBg.setAttribute("width", "280");
            uphillBg.setAttribute("height", "70");
            diagramOverlay.appendChild(uphillBg);

            // ä¸Šå¡å…¬å¼æ–‡æœ¬
            const uphillFormula = document.createElementNS(svgNS, "text");
            uphillFormula.setAttribute("class", "formula-text");
            uphillFormula.setAttribute("x", uphillMidX);
            uphillFormula.setAttribute("y", uphillMidY +15);
            uphillFormula.setAttribute("text-anchor", "middle");
            uphillFormula.setAttribute("font-size", "18px");
            if (isBtoA) {
                uphillFormula.textContent = `ä¸Šå¡æ—¶é—´: tâ‚ = y/${uphillSpeed}`;
            } else {
                uphillFormula.textContent = `ä¸Šå¡æ—¶é—´: tâ‚ = x/${uphillSpeed}`;
            }
            diagramOverlay.appendChild(uphillFormula);

            const uphillFormula2 = document.createElementNS(svgNS, "text");
            uphillFormula2.setAttribute("class", "formula-text");
            uphillFormula2.setAttribute("x", uphillMidX);
            uphillFormula2.setAttribute("y", uphillMidY -10);
            uphillFormula2.setAttribute("text-anchor", "middle");
            uphillFormula2.setAttribute("font-size", "16px");
            if (isBtoA) {
                uphillFormula2.textContent = `ä¸Šå¡è·ç¦»: y (æœªçŸ¥)`;
            } else {
                uphillFormula2.textContent = `ä¸Šå¡è·ç¦»: x (æœªçŸ¥)`;
            }
            diagramOverlay.appendChild(uphillFormula2);

            // ä¸‹å¡æ®µå…¬å¼æ˜¾ç¤º
            let downhillMidX, downhillMidY;
            if (isBtoA) {
                // ä¹™åˆ°ç”²ï¼šä¸‹å¡åœ¨å·¦ä¾§ï¼ˆä»å³å¾€å·¦ï¼‰
                downhillMidX = (pathStartX + pathPeakX) / 2;
                downhillMidY = (pathStartY + pathPeakY) / 2;
            } else {
                // ç”²åˆ°ä¹™ï¼šä¸‹å¡åœ¨å³ä¾§ï¼ˆä»å·¦å¾€å³ï¼‰
                downhillMidX = (pathPeakX + pathEndX) / 2;
                downhillMidY = (pathPeakY + pathEndY) / 2;
            }

            // ä¸‹å¡å…¬å¼èƒŒæ™¯
            const downhillBg = document.createElementNS(svgNS, "rect");
            downhillBg.setAttribute("class", "formula-background");
            downhillBg.setAttribute("x", downhillMidX - 140);
            downhillBg.setAttribute("y", downhillMidY - 35);
            downhillBg.setAttribute("width", "280");
            downhillBg.setAttribute("height", "70");
            diagramOverlay.appendChild(downhillBg);

            // ä¸‹å¡å…¬å¼æ–‡æœ¬
            const downhillFormula = document.createElementNS(svgNS, "text");
            downhillFormula.setAttribute("class", "formula-text");
            downhillFormula.setAttribute("x", downhillMidX);
            downhillFormula.setAttribute("y", downhillMidY + 15);
            downhillFormula.setAttribute("text-anchor", "middle");
            downhillFormula.setAttribute("font-size", "18px");
            if (isBtoA) {
                downhillFormula.textContent = `ä¸‹å¡æ—¶é—´: tâ‚‚ = x/${downhillSpeed}`;
            } else {
                downhillFormula.textContent = `ä¸‹å¡æ—¶é—´: tâ‚‚ = y/${downhillSpeed}`;
            }
            diagramOverlay.appendChild(downhillFormula);

            const downhillFormula2 = document.createElementNS(svgNS, "text");
            downhillFormula2.setAttribute("class", "formula-text");
            downhillFormula2.setAttribute("x", downhillMidX);
            downhillFormula2.setAttribute("y", downhillMidY - 10);
            downhillFormula2.setAttribute("text-anchor", "middle");
            downhillFormula2.setAttribute("font-size", "16px");
            if (isBtoA) {
                downhillFormula2.textContent = `ä¸‹å¡è·ç¦»: x (æœªçŸ¥)`;
            } else {
                downhillFormula2.textContent = `ä¸‹å¡è·ç¦»: y (æœªçŸ¥)`;
            }
            diagramOverlay.appendChild(downhillFormula2);

            // æ€»æ—¶é—´å…¬å¼æ˜¾ç¤ºåœ¨é¡¶éƒ¨
            const totalFormulaBg = document.createElementNS(svgNS, "rect");
            totalFormulaBg.setAttribute("class", "formula-background");
            totalFormulaBg.setAttribute("x", pathPeakX - 200);
            totalFormulaBg.setAttribute("y", pathPeakY - 50);
            totalFormulaBg.setAttribute("width", "400");
            totalFormulaBg.setAttribute("height", "80");
            diagramOverlay.appendChild(totalFormulaBg);

            // æ ¹æ®å½“å‰é¢„è®¾æ˜¾ç¤ºä¸åŒçš„æ€»æ—¶é—´å…¬å¼
            let totalTimeFormula = '';
            let formulaY = pathPeakY - 15;

            if (isBtoA) {
                // è¿”ç¨‹ï¼šy/40 + x/60 = 13/4
                totalTimeFormula = `è¿”ç¨‹: tâ‚ + tâ‚‚ = y/${uphillSpeed} + x/${downhillSpeed} = 13/4`;
            } else {
                // å»ç¨‹ï¼šx/40 + y/60 = 3
                totalTimeFormula = `å»ç¨‹: tâ‚ + tâ‚‚ = x/${uphillSpeed} + y/${downhillSpeed} = 3`;
            }

            const totalFormula = document.createElementNS(svgNS, "text");
            totalFormula.setAttribute("class", "formula-text");
            totalFormula.setAttribute("x", pathPeakX);
            totalFormula.setAttribute("y", formulaY);
            totalFormula.setAttribute("text-anchor", "middle");
            totalFormula.setAttribute("font-size", "16px");
            totalFormula.textContent = totalTimeFormula;
            diagramOverlay.appendChild(totalFormula);

            // æ·»åŠ è¯´æ˜æ–‡å­—
            const noteText = document.createElementNS(svgNS, "text");
            noteText.setAttribute("class", "formula-text");
            noteText.setAttribute("x", pathPeakX);
            noteText.setAttribute("y", formulaY + 20);
            noteText.setAttribute("text-anchor", "middle");
            noteText.setAttribute("font-size", "13px");
            noteText.setAttribute("fill", "#666");
            noteText.textContent = "æ³¨ï¼šxå’Œyæ˜¯æœªçŸ¥æ•°ï¼Œéœ€è¦é€šè¿‡æ–¹ç¨‹ç»„æ±‚è§£";
            diagramOverlay.appendChild(noteText);
        }

        // åŠ¨ç”»å‡½æ•°
        function animate(timestamp) {
            if (!lastTimestamp) lastTimestamp = timestamp;

            const elapsedSeconds = (timestamp - lastTimestamp) / 1000;
            lastTimestamp = timestamp;

            if (isAnimating && !isPaused) {
                // è·å–å½“å‰é¢„è®¾æ–¹å‘
                const currentPreset = document.querySelector('.preset-btn.active')?.getAttribute('data-preset') || 'atob';
                const isBtoA = currentPreset === 'btoa';

                // è®¡ç®—å½“å‰é€Ÿåº¦
                const currentSpeed = getCurrentSpeed(currentPosition);

                // è®¡ç®—ç§»åŠ¨çš„è·ç¦»(km)ï¼Œåº”ç”¨æ—¶é—´å€ç‡
                const distanceIncrement = (currentSpeed * elapsedSeconds * timeRate) / 3600;

                // æ›´æ–°ä½ç½®
                const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);

                if (isBtoA) {
                    // ä»å³å¾€å·¦ï¼šä½ç½®é€’å‡
                    currentPosition -= distanceIncrement / totalDistance;
                    if (currentPosition <= 0) {
                        currentPosition = 0;
                        isAnimating = false;
                        startBtn.disabled = false;
                        pauseBtn.disabled = true;
                        pauseBtn.textContent = "æš‚åœ";
                        isPaused = false;
                    }
                } else {
                    // ä»å·¦å¾€å³ï¼šä½ç½®é€’å¢
                    currentPosition += distanceIncrement / totalDistance;
                    if (currentPosition >= 1) {
                        currentPosition = 1;
                        isAnimating = false;
                        startBtn.disabled = false;
                        pauseBtn.disabled = true;
                        pauseBtn.textContent = "æš‚åœ";
                        isPaused = false;
                    }
                }

                currentDistance += distanceIncrement;
                currentTime += (elapsedSeconds * timeRate) / 3600;

                // æ›´æ–°æ±½è½¦ä½ç½®å’Œè§’åº¦
                updateCarPosition();

                // æ›´æ–°ä¿¡æ¯é¢æ¿
                updateInfoPanel(currentPosition, currentDistance, currentTime);

                // æ›´æ–°æ•°å­¦å…³ç³»æ˜¾ç¤º
                updateDiagram();
            }

            // ç»§ç»­åŠ¨ç”»
            if (isAnimating) {
                animationId = requestAnimationFrame(animate);
            }
        }

        // æ›´æ–°æ±½è½¦ä½ç½®å’Œè§’åº¦
        function updateCarPosition() {
            const hillScene = document.querySelector('.hill-scene');
            const hillWidth = hillScene.offsetWidth;
            const hillHeight = hillScene.offsetHeight;

            // è·å–å½“å‰é¢„è®¾æ–¹å‘
            const currentPreset = document.querySelector('.preset-btn.active')?.getAttribute('data-preset') || 'atob';
            const isBtoA = currentPreset === 'btoa';

            // è®¡ç®—å½“å‰ç‚¹åœ¨è·¯å¾„ä¸Šçš„ä½ç½®
            const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
            const uphillRatio = parseFloat(uphillDistanceSlider.value) / totalDistance;

            let pointX, pointY;
            let actualPosition = currentPosition;

            if (isBtoA) {
                // ä»å³å¾€å·¦ï¼šåè½¬ä½ç½®
                actualPosition = 1 - currentPosition;
            }

            if (actualPosition <= uphillRatio) {
                // ä¸Šå¡æ®µ
                const progress = actualPosition / uphillRatio;
                if (isBtoA) {
                    // ä»å³å¾€å·¦ï¼šä»ç»ˆç‚¹åˆ°èµ·ç‚¹
                    pointX = pathEndX - (pathEndX - pathPeakX) * progress;
                    pointY = pathEndY - (pathEndY - pathPeakY) * progress;
                } else {
                    // ä»å·¦å¾€å³ï¼šä»èµ·ç‚¹åˆ°é¡¶ç‚¹
                    pointX = pathStartX + (pathPeakX - pathStartX) * progress;
                    pointY = pathStartY + (pathPeakY - pathStartY) * progress;
                }
            } else {
                // ä¸‹å¡æ®µ
                const progress = (actualPosition - uphillRatio) / (1 - uphillRatio);
                if (isBtoA) {
                    // ä»å³å¾€å·¦ï¼šä»é¡¶ç‚¹åˆ°èµ·ç‚¹
                    pointX = pathPeakX - (pathPeakX - pathStartX) * progress;
                    pointY = pathPeakY - (pathPeakY - pathStartY) * progress;
                } else {
                    // ä»å·¦å¾€å³ï¼šä»é¡¶ç‚¹åˆ°ç»ˆç‚¹
                    pointX = pathPeakX + (pathEndX - pathPeakX) * progress;
                    pointY = pathPeakY + (pathEndY - pathPeakY) * progress;
                }
            }

            // è®¡ç®—æ–œç‡/è§’åº¦
            let slope, angle;

            if (actualPosition <= uphillRatio) {
                // ä¸Šå¡æ®µ
                if (isBtoA) {
                    // ä»å³å¾€å·¦ï¼šè®¡ç®—ä»ç»ˆç‚¹åˆ°é¡¶ç‚¹çš„æ–œç‡ï¼ˆæ–¹å‘ç›¸åï¼‰
                    slope = (pathPeakY - pathEndY) / (pathPeakX - pathEndX);
                } else {
                    slope = (pathPeakY - pathStartY) / (pathPeakX - pathStartX);
                }
            } else {
                // ä¸‹å¡æ®µ
                if (isBtoA) {
                    // ä»å³å¾€å·¦ï¼šè®¡ç®—ä»é¡¶ç‚¹åˆ°èµ·ç‚¹çš„æ–œç‡ï¼ˆæ–¹å‘ç›¸åï¼‰
                    slope = (pathStartY - pathPeakY) / (pathStartX - pathPeakX);
                } else {
                    slope = (pathEndY - pathPeakY) / (pathEndX - pathPeakX);
                }
            }

            angle = Math.atan(slope) * 180 / Math.PI;

            // ä»å³å¾€å·¦æ—¶ï¼Œæ°´å¹³ç¿»è½¬æ±½è½¦ï¼Œè€Œä¸æ˜¯æ—‹è½¬180åº¦
            let transform = `rotate(${angle}deg)`;
            if (isBtoA) {
                transform += ` scaleX(-1)`;
            }

            // æ›´æ–°æ±½è½¦ä½ç½®å’Œæ—‹è½¬
            // å°†SVGåæ ‡è½¬æ¢ä¸ºåƒç´ åæ ‡
            const carX = (pointX / 1000) * hillWidth - 40; // å‡å»æ±½è½¦å®½åº¦çš„ä¸€åŠä½¿å…¶å±…ä¸­
            const carY = (pointY / 200) * (hillHeight * 0.7) - 20; // è°ƒæ•´Yåæ ‡è®¡ç®—

            car.style.left = `${carX}px`;
            car.style.top = `${carY}px`;
            car.style.transform = transform;
        }

// åˆå§‹åŒ–æ±½è½¦ä½ç½®
        function initializeCarPosition() {
            const hillScene = document.querySelector('.hill-scene');
            const hillWidth = hillScene.offsetWidth;
            const hillHeight = hillScene.offsetHeight;

            // è®¾ç½®åˆå§‹ä½ç½®åœ¨èµ·ç‚¹
            const startX = (pathStartX / 1000) * hillWidth - 40;
            const startY = (pathStartY / 200) * (hillHeight * 0.7) - 20;

            car.style.left = `${startX}px`;
            car.style.top = `${startY}px`;
            car.style.transform = 'rotate(0deg)';
        }

        // å¼€å§‹åŠ¨ç”»
        startBtn.addEventListener('click', function () {
            if (!isAnimating) {
                isAnimating = true;
                isPaused = false;
                lastTimestamp = 0;
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                animationId = requestAnimationFrame(animate);
            }
        });

        // æš‚åœ/ç»§ç»­åŠ¨ç”»
        pauseBtn.addEventListener('click', function () {
            if (isAnimating) {
                if (isPaused) {
                    // ç»§ç»­åŠ¨ç”»
                    isPaused = false;
                    pauseBtn.textContent = "æš‚åœ";
                    lastTimestamp = 0;
                    animationId = requestAnimationFrame(animate);
                } else {
                    // æš‚åœåŠ¨ç”»
                    isPaused = true;
                    pauseBtn.textContent = "ç»§ç»­";
                }
            }
        });

        // é‡ç½®åŠ¨ç”»
        resetBtn.addEventListener('click', function () {
            isAnimating = false;
            isPaused = false;
            currentDistance = 0;
            currentTime = 0;

            // æ ¹æ®å½“å‰é¢„è®¾è®¾ç½®åˆå§‹ä½ç½®
            const currentPreset = document.querySelector('.preset-btn.active')?.getAttribute('data-preset') || 'atob';
            if (currentPreset === 'btoa') {
                currentPosition = 1; // ä»å³å¾€å·¦ï¼Œä»1å¼€å§‹
            } else {
                currentPosition = 0; // ä»å·¦å¾€å³ï¼Œä»0å¼€å§‹
            }

            cancelAnimationFrame(animationId);

            // é‡ç½®æ±½è½¦ä½ç½®
            updateCarPosition();

            // é‡ç½®ä¿¡æ¯é¢æ¿
            updateInfoPanel(currentPosition, 0, 0);

            // æ›´æ–°æ•°å­¦å…³ç³»æ˜¾ç¤º
            updateDiagram();

            // é‡ç½®æŒ‰é’®çŠ¶æ€
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.textContent = "æš‚åœ";
        });

        // åˆå§‹åŒ–ä¿¡æ¯é¢æ¿
        updateInfoPanel(0, 0, 0);
        updateCarPosition();
        updateDiagram();

        // æ¸²æŸ“æ•°å­¦å…¬å¼
        if (typeof renderMathInElement !== 'undefined') {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ]
            });
        }
    });
</script>
<script src="navigation.js"></script>
</body>
</html>