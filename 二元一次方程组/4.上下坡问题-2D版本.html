<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汽车上下坡问题 - 交互式动画</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(to bottom, #1a2980, #26d0ce);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .problem-description {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .problem-description p {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .simulation-area {
            flex: 2;
            min-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .animation-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .animation-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .hill-scene {
            position: relative;
            width: 100%;
            height: 300px;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 3px solid #3498db;
        }

        .sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 70%;
            background: linear-gradient(to bottom, #1e90ff, #87ceeb);
        }

        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30%;
            background: linear-gradient(to top, #8bc34a, #7cb342);
        }

        .hill {
            position: absolute;
            bottom: 30%;
            width: 100%;
            height: 200px;
            background: linear-gradient(to top, #795548, #5d4037);
            clip-path: polygon(0% 100%, 35% 0%, 65% 0%, 100% 100%);
        }

        .road {
            position: absolute;
            bottom: 30%;
            width: 100%;
            height: 30px;
            background: #555;
        }

        .car {
            position: absolute;
            bottom: 35%;
            left: 5%;
            width: 80px;
            height: 40px;
            background: #e74c3c;
            border-radius: 10px 10px 0 0;
            transition: left 0.05s linear;
            z-index: 10;
        }

        .car-body {
            position: absolute;
            width: 100%;
            height: 70%;
            background: #e74c3c;
            border-radius: 10px 10px 0 0;
        }

        .car-top {
            position: absolute;
            top: 8px;
            left: 10px;
            width: 40px;
            height: 20px;
            background: #3498db;
            border-radius: 5px;
        }

        .wheel {
            position: absolute;
            bottom: -8px;
            width: 16px;
            height: 16px;
            background: #2c3e50;
            border-radius: 50%;
            border: 2px solid #7f8c8d;
        }

        .wheel.front {
            left: 15px;
        }

        .wheel.back {
            right: 15px;
        }

        .energy-display {
            position: absolute;
            right: 15px;
            top: 15px;
            width: 150px;
            height: 150px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 5;
        }

        .energy-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .energy-bar-container {
            margin-bottom: 15px;
        }

        .energy-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .energy-bar {
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            background: #ecf0f1;
        }

        .kinetic-energy {
            height: 100%;
            background: #e74c3c;
            width: 50%;
            transition: width 0.3s;
        }

        .potential-energy {
            height: 100%;
            background: #3498db;
            width: 50%;
            transition: width 0.3s;
        }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .info-card {
            background: #3498db;
            color: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider {
            flex: 1;
            height: 10px;
            -webkit-appearance: none;
            background: #ddd;
            border-radius: 5px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
        }

        .time-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .time-rate-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .time-rate-buttons {
            display: flex;
            gap: 10px;
        }

        .time-rate-btn {
            padding: 8px 15px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-rate-btn:hover {
            background: #27ae60;
        }

        .time-rate-btn.active {
            background: #e74c3c;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            padding: 12px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            flex: 1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .calculation-area {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .step {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #3498db;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }

        .equation {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            overflow-x: auto;
        }

        .final-answer {
            background: #e8f5e9;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border-left: 5px solid #4caf50;
        }

        .final-answer h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }

            .simulation-area {
                min-width: 100%;
            }

            .info-panel {
                grid-template-columns: repeat(2, 1fr);
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>汽车上下坡问题</h1>
        <p class="subtitle">交互式物理与数学模拟</p>
    </header>

    <div class="content">
        <div class="problem-description">
            <h2>问题描述</h2>
            <p>一辆汽车在上下坡过程中，速度会发生变化：</p>
            <p>• 上坡时，速度为 \( 28 \, \text{km/h} \)</p>
            <p>• 下坡时，速度为 \( 42 \, \text{km/h} \)</p>
            <p>从甲地到乙地用了 4 小时 30 分钟，返回时用了 4 小时 40 分钟。</p>
            <p><strong>问题：</strong>从甲地到乙地的上坡路和下坡路各是多少千米？</p>

            <div class="final-answer">
                <h3>最终答案</h3>
                <p>从甲地到乙地的上坡路为 \( 70 \) 千米</p>
                <p>从甲地到乙地的下坡路为 \( 84 \) 千米</p>
            </div>
        </div>

        <div class="simulation-area">
            <div class="animation-container">
                <div class="animation-title">
                    <h2>上下坡模拟</h2>
                    <div class="energy-display">
                        <div class="energy-title">能量转换</div>
                        <div class="energy-bar-container">
                            <div class="energy-label">
                                <span>动能</span>
                                <span id="kineticPercent">50%</span>
                            </div>
                            <div class="energy-bar">
                                <div class="kinetic-energy" id="kineticEnergy"></div>
                            </div>
                        </div>
                        <div class="energy-bar-container">
                            <div class="energy-label">
                                <span>势能</span>
                                <span id="potentialPercent">50%</span>
                            </div>
                            <div class="energy-bar">
                                <div class="potential-energy" id="potentialEnergy"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="hill-scene">
                    <div class="sky"></div>
                    <div class="hill"></div>
                    <div class="ground"></div>
                    <div class="road"></div>
                    <div class="car">
                        <div class="car-body"></div>
                        <div class="car-top"></div>
                        <div class="wheel front"></div>
                        <div class="wheel back"></div>
                    </div>
                </div>

                <div class="info-panel">
                    <div class="info-card">
                        <div>当前位置</div>
                        <div class="info-value" id="position">起点</div>
                    </div>
                    <div class="info-card">
                        <div>当前速度</div>
                        <div class="info-value" id="speed">0 km/h</div>
                    </div>
                    <div class="info-card">
                        <div>已用时间</div>
                        <div class="info-value" id="time">0 小时</div>
                    </div>
                    <div class="info-card">
                        <div>行驶距离</div>
                        <div class="info-value" id="distance">0 km</div>
                    </div>
                </div>
            </div>

            <div class="controls-panel">
                <h2>控制面板</h2>
                <div class="controls">
                    <div class="control-group">
                        <div class="control-title">上坡速度 (km/h)</div>
                        <div class="slider-container">
                            <input type="range" min="10" max="50" value="28" class="slider" id="uphillSpeed">
                            <span class="slider-value" id="uphillSpeedValue">28</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-title">下坡速度 (km/h)</div>
                        <div class="slider-container">
                            <input type="range" min="10" max="50" value="42" class="slider" id="downhillSpeed">
                            <span class="slider-value" id="downhillSpeedValue">42</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-title">上坡距离 (km)</div>
                        <div class="slider-container">
                            <input type="range" min="10" max="100" value="70" class="slider" id="uphillDistance">
                            <span class="slider-value" id="uphillDistanceValue">70</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-title">下坡距离 (km)</div>
                        <div class="slider-container">
                            <input type="range" min="10" max="100" value="84" class="slider" id="downhillDistance">
                            <span class="slider-value" id="downhillDistanceValue">84</span>
                        </div>
                    </div>
                </div>

                <div class="time-controls">
                    <h3>时间控制</h3>
                    <div class="control-group">
                        <div class="control-title">时间倍率</div>
                        <div class="slider-container">
                            <input type="range" min="1" max="1000" value="5" class="slider" id="timeRate">
                            <span class="slider-value" id="timeRateValue">5x</span>
                        </div>
                    </div>

                    <div class="time-rate-control">
                        <div class="control-title">快速设置:</div>
                        <div class="time-rate-buttons">
                            <button class="time-rate-btn" data-rate="1">1x</button>
                            <button class="time-rate-btn active" data-rate="10">10x</button>
                            <button class="time-rate-btn" data-rate="100">100x</button>
                            <button class="time-rate-btn" data-rate="500">500x</button>
                            <button class="time-rate-btn" data-rate="1000">1000x</button>
                        </div>
                    </div>
                </div>

                <div class="buttons">
                    <button id="startBtn">开始模拟</button>
                    <button id="pauseBtn" disabled>暂停</button>
                    <button id="resetBtn">重置</button>
                </div>
            </div>
        </div>
    </div>

    <div class="calculation-area">
        <h2>计算过程</h2>
        <div class="step">
            <span class="step-number">1</span>
            <strong>设未知数</strong>
            <p>设从甲地到乙地的上坡路为 \( x \) 千米，下坡路为 \( y \) 千米。</p>
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <strong>建立方程</strong>
            <p>从甲地到乙地：上坡时间 \( \frac{x}{28} \) 小时，下坡时间 \( \frac{y}{42} \) 小时</p>
            <div class="equation">
                \[ \frac{x}{28} + \frac{y}{42} = 4.5 \]
            </div>

            <p>从乙地到甲地：上坡时间 \( \frac{y}{28} \) 小时，下坡时间 \( \frac{x}{42} \) 小时</p>
            <div class="equation">
                \[ \frac{y}{28} + \frac{x}{42} = \frac{14}{3} \]
            </div>
        </div>

        <div class="step">
            <span class="step-number">3</span>
            <strong>解方程组</strong>
            <p>化简方程组：</p>
            <div class="equation">
                \[
                \begin{cases}
                3x + 2y = 378 \\
                2x + 3y = 392
                \end{cases}
                \]
            </div>

            <p>解得：</p>
            <div class="equation">
                \[ x = 70, \quad y = 84 \]
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 获取DOM元素
        const car = document.querySelector('.car');
        const kineticEnergy = document.getElementById('kineticEnergy');
        const potentialEnergy = document.getElementById('potentialEnergy');
        const kineticPercent = document.getElementById('kineticPercent');
        const potentialPercent = document.getElementById('potentialPercent');
        const positionElement = document.getElementById('position');
        const speedElement = document.getElementById('speed');
        const timeElement = document.getElementById('time');
        const distanceElement = document.getElementById('distance');

        const uphillSpeedSlider = document.getElementById('uphillSpeed');
        const downhillSpeedSlider = document.getElementById('downhillSpeed');
        const uphillDistanceSlider = document.getElementById('uphillDistance');
        const downhillDistanceSlider = document.getElementById('downhillDistance');
        const timeRateSlider = document.getElementById('timeRate');

        const uphillSpeedValue = document.getElementById('uphillSpeedValue');
        const downhillSpeedValue = document.getElementById('downhillSpeedValue');
        const uphillDistanceValue = document.getElementById('uphillDistanceValue');
        const downhillDistanceValue = document.getElementById('downhillDistanceValue');
        const timeRateValue = document.getElementById('timeRateValue');

        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const timeRateButtons = document.querySelectorAll('.time-rate-btn');

        // 状态变量
        let animationId = null;
        let isAnimating = false;
        let isPaused = false;
        let lastTimestamp = 0;
        let currentPosition = 0; // 0-1 表示位置比例
        let currentDistance = 0; // 已行驶距离(km)
        let currentTime = 0; // 已用时间(小时)
        let timeRate = 5; // 时间倍率，默认5倍

        // 更新滑块显示值
        function updateSliderValues() {
            uphillSpeedValue.textContent = uphillSpeedSlider.value;
            downhillSpeedValue.textContent = downhillSpeedSlider.value;
            uphillDistanceValue.textContent = uphillDistanceSlider.value;
            downhillDistanceValue.textContent = downhillDistanceSlider.value;
            timeRateValue.textContent = `${timeRateSlider.value}x`;
            timeRate = parseInt(timeRateSlider.value);
        }

        // 初始化滑块值
        updateSliderValues();

        // 滑块事件监听
        uphillSpeedSlider.addEventListener('input', updateSliderValues);
        downhillSpeedSlider.addEventListener('input', updateSliderValues);
        uphillDistanceSlider.addEventListener('input', updateSliderValues);
        downhillDistanceSlider.addEventListener('input', updateSliderValues);
        timeRateSlider.addEventListener('input', updateSliderValues);

        // 时间倍率按钮事件
        timeRateButtons.forEach(button => {
            button.addEventListener('click', function() {
                const rate = parseInt(this.getAttribute('data-rate'));
                timeRateSlider.value = rate;
                updateSliderValues();

                // 更新按钮状态
                timeRateButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // 获取当前速度(基于位置)
        function getCurrentSpeed(position) {
            const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
            const uphillRatio = parseFloat(uphillDistanceSlider.value) / totalDistance;

            if (position <= uphillRatio) {
                // 上坡段
                return parseFloat(uphillSpeedSlider.value);
            } else {
                // 下坡段
                return parseFloat(downhillSpeedSlider.value);
            }
        }

        // 更新能量条
        function updateEnergyBars(position) {
            const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
            const uphillRatio = parseFloat(uphillDistanceSlider.value) / totalDistance;

            let kineticWidth, potentialWidth;

            if (position <= uphillRatio) {
                // 上坡段：动能减少，势能增加
                const progress = position / uphillRatio;
                kineticWidth = 100 - (70 * progress);
                potentialWidth = 30 + (70 * progress);
            } else {
                // 下坡段：动能增加，势能减少
                const progress = (position - uphillRatio) / (1 - uphillRatio);
                kineticWidth = 30 + (70 * progress);
                potentialWidth = 100 - (70 * progress);
            }

            kineticEnergy.style.width = `${kineticWidth}%`;
            potentialEnergy.style.width = `${potentialWidth}%`;

            kineticPercent.textContent = `${Math.round(kineticWidth)}%`;
            potentialPercent.textContent = `${Math.round(potentialWidth)}%`;
        }

        // 更新信息面板
        function updateInfoPanel(position, distance, time) {
            const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
            const uphillRatio = parseFloat(uphillDistanceSlider.value) / totalDistance;

            // 更新位置
            if (position < 0.01) {
                positionElement.textContent = "起点";
            } else if (position > 0.99) {
                positionElement.textContent = "终点";
            } else if (position <= uphillRatio) {
                positionElement.textContent = "上坡中";
            } else {
                positionElement.textContent = "下坡中";
            }

            // 更新速度
            speedElement.textContent = `${getCurrentSpeed(position)} km/h`;

            // 更新时间和距离
            timeElement.textContent = `${time.toFixed(2)} 小时`;
            distanceElement.textContent = `${distance.toFixed(1)} km`;
        }

        // 动画函数
        function animate(timestamp) {
            if (!lastTimestamp) lastTimestamp = timestamp;

            const elapsedSeconds = (timestamp - lastTimestamp) / 1000;
            lastTimestamp = timestamp;

            if (isAnimating && !isPaused) {
                // 计算当前速度
                const currentSpeed = getCurrentSpeed(currentPosition);

                // 计算移动的距离(km)，应用时间倍率
                const distanceIncrement = (currentSpeed * elapsedSeconds * timeRate) / 3600;

                // 更新位置
                const totalDistance = parseFloat(uphillDistanceSlider.value) + parseFloat(downhillDistanceSlider.value);
                currentPosition += distanceIncrement / totalDistance;
                currentDistance += distanceIncrement;
                currentTime += (elapsedSeconds * timeRate) / 3600;

                // 检查是否到达终点
                if (currentPosition >= 1) {
                    currentPosition = 1;
                    isAnimating = false;
                    startBtn.disabled = false;
                    pauseBtn.disabled = true;
                    pauseBtn.textContent = "暂停";
                    isPaused = false;
                }

                // 更新汽车位置
                const hillWidth = document.querySelector('.hill-scene').offsetWidth;
                const carWidth = car.offsetWidth;
                const carPosition = (hillWidth - carWidth) * currentPosition;
                car.style.left = `${carPosition}px`;

                // 更新能量条
                updateEnergyBars(currentPosition);

                // 更新信息面板
                updateInfoPanel(currentPosition, currentDistance, currentTime);
            }

            // 继续动画
            if (isAnimating) {
                animationId = requestAnimationFrame(animate);
            }
        }

        // 开始动画
        startBtn.addEventListener('click', function() {
            if (!isAnimating) {
                isAnimating = true;
                isPaused = false;
                lastTimestamp = 0;
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                animationId = requestAnimationFrame(animate);
            }
        });

        // 暂停/继续动画
        pauseBtn.addEventListener('click', function() {
            if (isAnimating) {
                if (isPaused) {
                    // 继续动画
                    isPaused = false;
                    pauseBtn.textContent = "暂停";
                    lastTimestamp = 0;
                    animationId = requestAnimationFrame(animate);
                } else {
                    // 暂停动画
                    isPaused = true;
                    pauseBtn.textContent = "继续";
                }
            }
        });

        // 重置动画
        resetBtn.addEventListener('click', function() {
            isAnimating = false;
            isPaused = false;
            currentPosition = 0;
            currentDistance = 0;
            currentTime = 0;

            cancelAnimationFrame(animationId);

            // 重置汽车位置
            car.style.left = '5%';

            // 重置能量条
            updateEnergyBars(0);

            // 重置信息面板
            updateInfoPanel(0, 0, 0);

            // 重置按钮状态
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.textContent = "暂停";
        });

        // 初始化能量条和信息面板
        updateEnergyBars(0);
        updateInfoPanel(0, 0, 0);

        // 渲染数学公式
        if (typeof renderMathInElement !== 'undefined') {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ]
            });
        }
    });
</script>
</body>
</html>